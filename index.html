<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Permissions-Policy" content="fullscreen=(self)">
  <title>Home</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <meta name="description" content="V2: An immersive and secure Chromium VM running just on your browser, sign-up today!">

  <!-- ‚Äî‚Äî AUTH OVERLAY ‚Äî‚Äî -->
  <div id="overlay">
  <div id="auth-overlay">
    <div id="auth-box">
      <h2 id="auth-title">Login</h2>
      <input type="text" id="auth-username" placeholder="Username" autocomplete="username">
      <input type="password" id="auth-password" placeholder="Password" autocomplete="current-password">
      <button id="auth-submit">Login</button>
      <button id="auth-guest"><b>Guest</b></button>
      <div id="auth-error"></div>
      <button id="auth-toggle">Don't have an account? Sign up</button>
      <i>Forgot password?</i>
      <i>E-mail <u>recover@cvm.rest</u> to get assistance</i>
    </div>
  </div>
    </div>
<body>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <meta name="description" content="Version 2.1: An immersive and secure Chromium VM sandbox running just on your browser!">

  <!-- Disable right-click -->
  <script>
    ['contextmenu','mousedown','mouseup'].forEach(evt =>
      document.addEventListener(evt, e => {
        if (evt==='contextmenu' || e.button===2) {
          e.preventDefault(); return false;
        }
      })
    );
  </script>

  <!-- Overlays -->

    <!-- PAGE-LOAD ALERT (visible immediately) -->
 <div id="alertBox">
  <div class="alert-content">
    <span style="font-size:48px;">ü´§</span>
    <h2>Announcement:</h2>
    <p>CVM development is currently paused, so there won't be any new updates, don't worry though, if anything breaks I WILL fix it!</p>
    <b> </b>
    <p>I am aware that HB is <b>rate-limiting</b>, it lasts a <u>MONTH</u>, and there is nothing I can do about it, so if a server doesn't work, try a different one, but if <b>ALL</b> of the servers get rate-limited, then I guess we're cooked... But, more servers will come if this happens too often. Very sorry for the inconvenience!</p>
     <div class="2030">
    <img
      src="https://cvm.rest/img/vapor.png"
      alt="..."
      draggable="false"
    >
    <div class="overlay-text">Partners?</div>
  </div>
    <b> </b>
    <button style="margin-top: 30px;" id="okButton">OK</button>
  </div>
</div>

  <div id="warning" class="overlay active">
    <div class="overlay-content">
      <h2>Thanks for using CVM!</h2>
      <p style="font-size:16px;">This app is in beta, and bugs may occur, if you found one, please email <b>broken-vm@craz.top</b></p>
      <i style="font-size:20px;">Why is there a time limit?</i>
      <p style="font-size:16.5px;">There is a time limit to keep things fair for other users, and to keep the servers up without crashing!</p>
      <i style="font-size:20px;">What is premium?</i>
      <p style="font-size:16.5px;">Premium accounts have longer session time (40 minutes), have a special theme, and are the first priority to fixing! It is only $1, if you are interested in purchasing, E-mail <b>premium@cvm.rest</b> (You are REQUIRED to have an account in order to purchase)</p>
      <p style="font-weight:bold;">
        <a href="https://cvm.rest/updates/" style="color:#55C629;text-decoration:underline;font-family:Impact, sans-serif;">
          Update logs
        </a>
      </p>
      <p style="font-weight:bold;">
        <a href="https://cvm.rest/dev/" style="color:#427B2C;text-decoration:underline;font-family:Impact, sans-serif;">
          I'm a developer for CVM
        </a>
      </p>
      <b>Select a server:</b>
      <div id="server-switch">
        <button data-url="https://hyperbeam.stilla-rrms-wlwv-k12-or-us.workers.dev/" class="selected">Main üî¥</button>
        <button data-url="https://hyperbeam-1.stilla-rrms-wlwv-k12-or-us.workers.dev/">1 üü¢</button>
        <button data-url="https://hyperbeam-2.stilla-rrms-wlwv-k12-or-us.workers.dev/">2 üî¥</button>
        <button data-url="https://hyperbeam-3.stilla-rrms-wlwv-k12-or-us.workers.dev/">3 üü¢</button>
        <button data-url="https://hyperbeam-4.stilla-rrms-wlwv-k12-or-us.workers.dev/">4 üü¢</button>
        <button data-url="https://hyperbeam-5.stilla-rrms-wlwv-k12-or-us.workers.dev/">5 üü¢</button>
        <button data-url="https://hyperbeam-6.stilla-rrms-wlwv-k12-or-us.workers.dev/">6 üü¢</button>
        <button data-url="https://hyperbeam-7.stilla-rrms-wlwv-k12-or-us.workers.dev/">7 üü¢</button>
        <button data-url="https://hyperbeam-8.stilla-rrms-wlwv-k12-or-us.workers.dev/">8 üü¢</button>
      </div>
      <p style="color:#ff4444;font-weight:bold;text-decoration:underline;">
        Warning: Keybinds on the VM will only work in fullscreen mode.
      </p>
      <p style="color:#FD0000;font-weight:bold;font-size:20px;">
        If every button is disabled, try refreshing the page. Also, if you leave this tab for more than five minutes, your session will end and your progress will be lost. This helps us free up VM space.
      </p>
      <label><input type="checkbox" id="acknowledge-checkbox"> I understand.</label><br>
      <button id="close-warning" disabled>Start session!</button><br>
      <i style="font-size:20px;margin-top:10px;display:block;">Version: 2.1</i>
    </div>
  </div>

  <div id="minute-warning" class="overlay">
    <div class="overlay-content">
      <p><span style="font-size:48px;">‚ö†Ô∏è</span> There is one minute left in your session.</p>
      <button id="minute-ok">OK</button>
    </div>
  </div>

  <div id="black-notif" class="overlay">
    <div class="overlay-content">
      <span style="font-size:48px;">ü§î</span>
      <p style="font-size:48px;">See only a black screen?</p>
      <button id="notif-yes">Yes, why?</button>
      <button id="notif-no">No, go away.</button>
    </div>
  </div>

  <div id="black-alert" class="overlay">
    <div class="overlay-content" style="display:flex;gap:15px;align-items:flex-start;">
      <div style="font-size:48px;line-height:1;">üíÄ</div>
      <div>
        <p style="font-size:24px;">If you just see a black screen for more than 5 seconds, it‚Äôs either:<br>
           1. HB was rate-limited<br>
           2. Too many users<br>
           3. The school blocked the frame<br>
           4. We're down temporarily</p>
        <p>Check back later or email <b>broken-vm@craz.top</b></p>
        <button id="black-ok">OK</button>
        <script>
  document.getElementById('black-ok').addEventListener('click', function () {
    window.location.href = 'https://cvm.rest';
  });
</script>
      </div>
    </div>
  </div>

  <!-- Hyperbeam VM & Errors -->
  <div id="hyperbeam-container"></div>
  <div id="error-message"></div>

  <!-- Bottom bar -->
 <div id="bottom-bar">
    <span id="timer">20:00</span>
    <button id="fullscreen-btn">
      <img src="https://cvm.rest/img/fullscreen.png" alt="FS" draggable="false">
    </button>

  <!-- Put signout *before* the auto-margin logo -->
  <button id="signout-btn">Sign Out</button>

  <!-- Your CVM logo ‚Äî now it will push *after* signout, not before -->
  <img src="https://cvm.rest/img/CVM.png" alt="CVM">

  <span id="copyright-text">2025 ¬© WZ LLC, VM by HB.</span>
</div>

  <!-- Fullscreen timer + toggle -->
  <div id="fullscreen-timer-wrapper">
    <div id="fullscreen-timer">20:00</div>
    <button id="toggle-timer-btn">&lt;</button>
  </div>

  <!-- Main script -->
<script type="module">
import Hyperbeam from "https://unpkg.com/@hyperbeam/web@latest/dist/index.js";

////////////////////////////////////////////////////////////////////////////////
// 1) YOUR PREMIUM CHECKER
function isUserPremium() {
  const token = localStorage.getItem("cvm_token");
  if (!token) return false;
  return localStorage.getItem("cvm_premium") === "1";
}

////////////////////////////////////////////////////////////////////////////////
// 2) EVERYTHING THAT USED TO LIVE IN DOMContentLoaded

function initApp() {
  // ======== apply premium theme ========
  // Premium theme toggle
// Premium theme toggle
// Premium theme toggle
if (isUserPremium()) {
  document.documentElement.classList.add("premium-theme");
} else {
  document.documentElement.classList.remove("premium-theme");
}

// ======== Replace content if user is premium ========
if (isUserPremium()) {
  // Change the <h2>
  const warningH2 = document.querySelector('#warning h2');
  if (warningH2) {
    warningH2.textContent = "Thanks for buying premium and using CVM!";
  }

  // Change the second paragraph inside #warning .overlay-content
  const paras = document.querySelectorAll('#warning .overlay-content p');
  if (paras[1]) {
    paras[1].textContent =
      "With premium, you got a special theme, 40 minutes of time, AND are the first priority to fixing, CVM is also updated frequently, so you will get early updates too!";
  }
  if (paras[2]) {
    paras[2].innerHTML = 
      `If you are enjoying premium, consider subscribing to my <a href="https://www.youtube.com/@wilburzenith" target="_blank" style="color:#55C629; text-decoration:underline;">YouTube</a> channel!`;
  }

  // Replace both <i> cases in one loop
  document.querySelectorAll('#warning .overlay-content i').forEach(elem => {
    const txt = elem.textContent.trim();
    if (txt === "What is premium?") {
      elem.textContent = " ";
    } else if (txt === "Why is there a time limit?") {
      elem.textContent = " ";
    }
  });

  // Replace #server-switch content
  const serverSwitch = document.getElementById('server-switch');
  if (serverSwitch) {
    serverSwitch.innerHTML = `
      <button data-url="https://hungry-hippo.stilla-rrms-wlwv-k12-or-us.workers.dev/" class="selected">Main üü¢</button>
      <button data-url="https://rubber-ducky.stilla-rrms-wlwv-k12-or-us.workers.dev/">1 üü¢</button>
    `;
  }

  // ======== Add personalized greeting below h2 ========
  const hour = new Date().getHours();
  const timeOfDay = hour < 12 ? "morning" : hour < 18 ? "afternoon" : "evening";
  const username = localStorage.getItem("cvm_username") || "User";
  const greetingText = `Good ${timeOfDay}, ${username}`;

  const h2 = document.querySelector("#warning .overlay-content > h2");
  if (h2) {
    const greeting = document.createElement("p");
    greeting.textContent = greetingText;
    greeting.style.fontSize = "30px";
    greeting.style.fontWeight = "bold";
    greeting.style.marginTop = "8px";
    h2.insertAdjacentElement("afterend", greeting);
  }
}

// Helper function to get current time of day string
function getTimeOfDay() {
  const hour = new Date().getHours();
  if (hour < 12) return "morning";
  if (hour < 18) return "afternoon";
  return "evening";
}

// Helper function to get username from localStorage (or fallback)
function getUsername() {
  return localStorage.getItem("cvm_username") || "User";
}

  // ======== grab our selected serverUrl ========
  let serverUrl = document.querySelector('#server-switch button.selected').dataset.url;

  // ======== server-switch listener ========
  document.querySelectorAll('#server-switch button').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('#server-switch button')
              .forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      serverUrl = btn.dataset.url;
    });
  });

  // ======== fullscreen toggle ========
  const fsWrapper = document.getElementById('fullscreen-timer-wrapper');
  const fsTimer   = document.getElementById('fullscreen-timer');
  const toggleBtn = document.getElementById('toggle-timer-btn');
  toggleBtn.addEventListener('click', () => {
    const hidden = fsTimer.style.display === 'none';
    fsTimer.style.display = hidden ? 'inline' : 'none';
    toggleBtn.textContent = hidden ? '<' : '>';
  });

  // ======== main start() ========
  async function start() {
    setTimeout(() => document.getElementById('black-notif').classList.add('active'), 5000);
    try {
      const res = await fetch(serverUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: "{}"
      });
      const { embed_url } = await res.json();
      await Hyperbeam(
        document.getElementById("hyperbeam-container"),
        embed_url,
        { iframeAttributes: { allow: "fullscreen" } }
      );
    } catch {
      const e = document.getElementById('error-message');
      e.style.display = 'block';
      e.textContent = "Stop trying to skid the VM, bro.";
    }
  }

  // ======== overlay & timer wiring ========
  let minuteAlertShown = false, timeoutExpired = false;
  document.getElementById('acknowledge-checkbox').addEventListener('change', e =>
    document.getElementById('close-warning').disabled = !e.target.checked
  );
  document.getElementById('close-warning').addEventListener('click', () => {
    document.getElementById('warning').classList.remove('active');
    start();
    startTimer();
  });
  document.getElementById('minute-ok').addEventListener('click', () =>
    document.getElementById('minute-warning').classList.remove('active')
  );
  document.getElementById('notif-no').addEventListener('click', () =>
    document.getElementById('black-notif').classList.remove('active')
  );
  document.getElementById('notif-yes').addEventListener('click', () => {
    document.getElementById('black-notif').classList.remove('active');
    document.getElementById('black-alert').classList.add('active');
  });
  document.getElementById('black-ok').addEventListener('click', () =>
    document.getElementById('black-alert').classList.remove('active')
  );
  document.getElementById('fullscreen-btn').addEventListener('click', async () => {
    if (!document.fullscreenElement) {
      await document.documentElement.requestFullscreen();
    } else {
      await document.exitFullscreen();
    }
  });
  document.addEventListener('fullscreenchange', () => {
    const inFS = !!document.fullscreenElement;
    document.getElementById('bottom-bar').style.display = inFS ? 'none' : 'flex';
    document.getElementById('hyperbeam-container')
            .classList.toggle('fullscreen-mode', inFS);
    fsWrapper.style.display = inFS ? 'flex' : 'none';
    if (inFS) { fsTimer.style.display = 'inline'; toggleBtn.textContent = '<'; }
  });

  // ======== timer ========
  function startTimer() {
    let t = isUserPremium() ? 40 * 60 : 20 * 60;
    updateTimerDisplay(t);
    const iv = setInterval(() => {
      if (t > 0) {
        t--;
        updateTimerDisplay(t);
        if (t === 60 && !minuteAlertShown) {
          minuteAlertShown = true;
          document.getElementById('minute-warning').classList.add('active');
        }
      } else {
        clearInterval(iv);
        timeoutExpired = true;
        window.removeEventListener('beforeunload', blockUnload);
        window.location.href = 'https://cvm.rest/';
      }
    }, 1000);
  }

  function updateTimerDisplay(seconds) {
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    const txt = `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
    document.getElementById('timer').textContent = txt;
    document.getElementById('fullscreen-timer').textContent = txt;
  }

  // ======== key blocking ========
  document.addEventListener('keydown', e => {
    if (e.ctrlKey) {
      if (!['c','v','C','V'].includes(e.key)) e.preventDefault();
    } else if (e.altKey||e.metaKey) {
      e.preventDefault();
    } else if (['F1','F5','Tab','Escape'].includes(e.key)) {
      e.preventDefault();
    }
  });
}

////////////////////////////////////////////////////////////////////////////////
// 3) HOOKING UP AUTH FLOW

document.addEventListener("DOMContentLoaded", () => {
  const overlay = document.getElementById("overlay");
  const guestBtn = document.getElementById("auth-guest");
  const submit   = document.getElementById("auth-submit");
  const toggle   = document.getElementById("auth-toggle");
  const titleEl  = document.getElementById("auth-title");
  const userEl   = document.getElementById("auth-username");
  const passEl   = document.getElementById("auth-password");
  const errorEl  = document.getElementById("auth-error");
  const WORKER_BASE = "https://cvm-accounts.stilla-rrms-wlwv-k12-or-us.workers.dev";

  let isSignup = false;
  let started  = false;

  function finishAuth() {
    overlay.style.display = "none";
    if (!started) {
      started = true;
      initApp();
    }
  }

  // Auto-login
  if (localStorage.getItem("cvm_token")) {
    finishAuth();
  }

  // Guest access
  guestBtn.addEventListener("click", finishAuth);

  // Toggle login/signup UI
  toggle.addEventListener("click", () => {
    isSignup = !isSignup;
    titleEl.textContent = isSignup ? "Sign Up" : "Login";
    submit.textContent   = isSignup ? "Sign Up" : "Login";
    toggle.textContent   = isSignup
      ? "Already have an account? Login"
      : "Don't have an account? Sign up";
    errorEl.textContent = "";
  });

  // Login / Sign Up flow
  submit.addEventListener("click", async () => {
    const username = userEl.value.trim();
    const password = passEl.value;
    if (!username || !password) {
      errorEl.textContent = "Please fill in both fields.";
      return;
    }
    const endpoint = isSignup ? "/signup" : "/login";
    try {
      const res = await fetch(WORKER_BASE + endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || "Unknown error");
localStorage.setItem("cvm_token", data.token);
localStorage.setItem("cvm_username", username);
localStorage.setItem("cvm_premium", data.premium ? "1" : "0");

if (isSignup) {
  finishAuth();
} else {
  finishAuth();
}
    } catch (err) {
      errorEl.textContent = err.message;
    }
  });
});
</script>
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const overlay = document.getElementById("overlay");

    const WORKER_BASE = "https://cvm-accounts.stilla-rrms-wlwv-k12-or-us.workers.dev";
    let isSignup = false;

    const titleEl = document.getElementById("auth-title");
    const userEl  = document.getElementById("auth-username");
    const passEl  = document.getElementById("auth-password");
    const submit  = document.getElementById("auth-submit");
    const toggle  = document.getElementById("auth-toggle");
    const guest   = document.getElementById("auth-guest");
    const errorEl = document.getElementById("auth-error");
    const signoutBtn = document.getElementById("signout-btn");

    function updateAuthUI() {
      const loggedIn = !!localStorage.getItem("cvm_token");
      if (signoutBtn) {
        signoutBtn.style.display = loggedIn ? "inline-block" : "none";
      }
    }

    toggle.addEventListener("click", () => {
      isSignup = !isSignup;
      titleEl.textContent  = isSignup ? "Sign Up" : "Login";
      submit.textContent   = isSignup ? "Sign Up" : "Login";
      toggle.textContent   = isSignup
        ? "Already have an account? Login"
        : "Don't have an account? Sign up";
      errorEl.textContent = "";
    });

  submit.addEventListener("click", async () => {
  const username = userEl.value.trim();
  const password = passEl.value;

  if (!username || !password) {
    errorEl.textContent = "Please fill in both fields.";
    return;
  }

  // Disable the button to prevent double-clicks
  submit.disabled = true;
  errorEl.textContent = ""; // clear previous errors

  const endpoint = isSignup ? "/signup" : "/login";

  try {
    const res = await fetch(WORKER_BASE + endpoint, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    const data = await res.json();
    if (!res.ok) {
      // Check for unique constraint
      if (data.error?.includes("UNIQUE")) {
        throw new Error("That username is already taken. Please choose another.");
      }
      throw new Error(data.error || "Unknown error");
    }

    localStorage.setItem("cvm_token", data.token);
    localStorage.setItem("cvm_username", username);
    localStorage.setItem("cvm_premium", data.premium ? "1" : "0");

    updateAuthUI();
    overlay.style.display = "none";

    // For signups, reload the page
   if (isSignup) {
  window.removeEventListener('beforeunload', handleBeforeUnload);
  location.reload();
}

  } catch (err) {
    errorEl.textContent = err.message;
    submit.disabled = false; // re-enable on error
  }
});
    guest.addEventListener("click", () => {
      overlay.style.display = "none";
    });

    if (localStorage.getItem("cvm_token")) {
      overlay.style.display = "none";
    }

    if (signoutBtn) {
      signoutBtn.addEventListener("click", () => {
        localStorage.removeItem("cvm_token");
        localStorage.removeItem("cvm_username");
        updateAuthUI();
        overlay.style.display = "flex";
      });
    }

    updateAuthUI(); // Call it once after page load
  });

   okButton.addEventListener("click", () => {
  document.getElementById("alertBox").classList.add("fade-out");
  setTimeout(() => {
    document.getElementById("alertBox").style.display = "none";
  }, 760);
});

document.addEventListener("DOMContentLoaded", () => {
  // Function to check if user is premium
  function isUserPremium() {
    const token = localStorage.getItem("cvm_token");
    if (!token) {
      console.log("No token found in localStorage, user is not premium.");
      return false;
    }
    const isPremium = localStorage.getItem("cvm_premium") === "1";
    console.log(`Premium status: ${isPremium}`);
    return isPremium;
  }

  // Function to get time of day
  function getTimeOfDay() {
    const hour = new Date().getHours();
    if (hour < 12) return "morning";
    if (hour < 18) return "afternoon";
    return "evening";
  }

  // Function to get username
  function getUsername() {
    const username = localStorage.getItem("cvm_username") || "User";
    console.log(`Username retrieved: "${username}"`);
    return username;
  }

  // Select the overlay-content container
  const overlayContent = document.querySelector("#warning .overlay-content");
  if (!overlayContent) {
    console.log("No overlay-content found in #warning, cannot proceed.");
    return;
  }

  // Select the h2 element
  const h2 = overlayContent.querySelector("h2");
  if (!h2) {
    console.log("No h2 found in overlay-content, cannot add greeting.");
    return;
  }

  // Step 1: Add greeting for all logged-in users
  const username = getUsername();
  if (username !== "User") { // Only add for logged-in users
    // Check for existing greeting by ID
    const existingGreeting = document.querySelector("#user-greeting");
    if (!existingGreeting) {
      const timeOfDay = getTimeOfDay();
      const greetingText = `Good ${timeOfDay}, ${username}`;
      const greeting = document.createElement("p");
      greeting.id = "user-greeting";
      greeting.textContent = greetingText;
      greeting.style.fontSize = "30px";
      greeting.style.fontWeight = "bold";
      greeting.style.marginTop = "8px";
      h2.insertAdjacentElement("afterend", greeting);
      console.log(`Created greeting: "${greetingText}"`);
    } else {
      console.log(`Greeting already exists with ID user-greeting: "${existingGreeting.textContent}"`);
    }
  } else {
    console.log("No username in localStorage (guest user), skipping greeting creation.");
  }

  // Step 2: Remove duplicates for all users (delayed to catch late additions)
  setTimeout(() => {
    console.log("Checking for duplicate paragraphs in overlay-content.");
    const paragraphs = overlayContent.querySelectorAll("p");
    if (paragraphs.length === 0) {
      console.log("No <p> elements found in overlay-content, nothing to check.");
      return;
    }

    // Log all paragraphs before processing
    console.log("Paragraphs before duplicate removal:");
    paragraphs.forEach((p, index) => {
      console.log(`Index ${index}: "${p.textContent}" (ID: ${p.id || "none"})`);
    });

    const seenText = new Set();
    paragraphs.forEach((p, index) => {
      const text = p.textContent.trim().toLowerCase();
      if (seenText.has(text)) {
        console.log(`Removing duplicate paragraph at index ${index}: "${p.textContent}" (ID: ${p.id || "none"})`);
        p.remove();
      } else {
        seenText.add(text);
        console.log(`Keeping paragraph at index ${index}: "${p.textContent}" (ID: ${p.id || "none"})`);
      }
    });

    console.log(`Duplicate check complete. Total paragraphs after processing: ${overlayContent.querySelectorAll("p").length}`);
  }, 100); // Small delay to allow other DOM modifications
});

    let awayTimestamp = null;
const maxAwayTime = 5 * 60 * 1000; // 5 minutes in ms

document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'hidden') {
    // User left tab, start timing
    awayTimestamp = Date.now();
  } else if (document.visibilityState === 'visible') {
    // User came back, reset timer
    awayTimestamp = null;
  }
});

setInterval(() => {
  if (awayTimestamp) {
    if (Date.now() - awayTimestamp > maxAwayTime) {
      window.removeEventListener('beforeunload', handleBeforeUnload);
      location.reload();
    }
  }
}, 10000); // check every 10 seconds

   function handleBeforeUnload(e) {
  e.preventDefault();
  e.returnValue = '';
}

window.addEventListener('beforeunload', handleBeforeUnload);
</script>
</body>
</html>
