<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Home</title>
  <meta http-equiv="Permissions-Policy" content="fullscreen=(self)">
  <style>
    body, html { margin: 0; height: 100%; background-color: black; position: relative; }
    #hyperbeam-container { width: 100%; height: calc(100vh - 50px); border: 5px solid white; }
    #bottom-bar { position: absolute; bottom: 0; width: 100%; height: 50px; background-color: #427B2C; display: flex; justify-content: center; align-items: center; color: white; box-shadow: 0 -2px 10px rgba(0,0,0,0.5); font-family: Impact, sans-serif; }
    #warning { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 1000; font-family: Impact, sans-serif; }
    #warning > div { background: white; padding: 20px; border-radius: 10px; max-width: 80%; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
    #timer { font-size: 24px; }
    #timer.small { font-size: 12px; }
    #fullscreen-btn { background-color: #427B2C; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-left: 20px; }
    #error-message { color: white; text-align: center; padding: 20px; font-family: Impact, sans-serif; display: none; }
  </style>
</head>
<body>
  <div id="warning">
    <div>
      <p>If nothing shows up, and it's just a black screen, many VMS are being used currently, so wait some time (like 30 min to 24 hours), and if it persists, email broken-vm@craz.top!</p>
      <button id="close-warning">Close</button>
    </div>
  </div>
  <div id="hyperbeam-container"></div>
  <div id="error-message">
    <p>If nothing shows up, and it's just a black screen, many VMS are being used currently, so wait some time (like 30 min to 24 hours), and if it persists, email broken-vm@craz.top!</p>
  </div>
  <div id="bottom-bar">
    <span id="timer">8:00</span>
    <button id="fullscreen-btn">Fullscreen</button>
  </div>

  <script type="module">
    import Hyperbeam from "https://unpkg.com/@hyperbeam/web@latest/dist/index.js";

    async function start() {
      try {
        const res = await fetch("https://hyperbeam.stilla-rrms-wlwv-k12-or-us.workers.dev/", {
          method: "POST"
        });
        const { embed_url } = await res.json();
        const hyperbeamInstance = await Hyperbeam(document.getElementById("hyperbeam-container"), embed_url, {
          iframeAttributes: { allow: "fullscreen" }
        });
      } catch (error) {
        document.getElementById('error-message').style.display = 'block';
      }
    }

    // Warning close button
    document.getElementById('close-warning').addEventListener('click', function() {
      document.getElementById('warning').style.display = 'none';
      
      // Start loading the VM and timer only after warning is closed
      start();

      let timeLeft = 480; // 8 minutes in seconds
      const timerInterval = setInterval(() => {
        if (timeLeft > 0) {
          timeLeft--;
          let minutes = Math.floor(timeLeft / 60);
          let seconds = timeLeft % 60;
          document.getElementById('timer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        } else {
          clearInterval(timerInterval);
          window.location.href = 'https://wilburz.com/';
        }
      }, 1000);
    });

    // Fullscreen button
    document.getElementById('fullscreen-btn').addEventListener('click', async () => {
      try {
        if (document.fullscreenEnabled) {
          await document.documentElement.requestFullscreen();
        } else {
          alert('Fullscreen is not supported in this context. This may be due to browser restrictions or the page being embedded in an iframe.');
        }
      } catch (error) {
        alert('Failed to enter fullscreen mode: ' + error.message);
      }
    });

    // Fullscreen change listener
    document.addEventListener('fullscreenchange', () => {
      if (document.fullscreenElement) {
        document.getElementById('timer').classList.add('small');
      } else {
        document.getElementById('timer').classList.remove('small');
      }
    });
  </script>
</body>
</html>
